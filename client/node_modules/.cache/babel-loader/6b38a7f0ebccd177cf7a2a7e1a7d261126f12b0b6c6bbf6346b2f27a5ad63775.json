{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\paete\\\\Prototype\\\\nftmusicProtoCopy\\\\client\\\\src\\\\contexts\\\\EthContext\\\\EthProvider.jsx\",\n  _s = $RefreshSig$();\nimport React, { useReducer, useCallback, useEffect, useState } from \"react\";\nimport Web3 from \"web3\";\nimport EthContext from \"./EthContext\";\nimport { reducer, actions, initialState } from \"./state\";\nimport WalletConnectProvdier from \"@walletconnect/web3-provider\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar newjson = [];\nvar imgjson = [];\nexport function EthProvider(_ref) {\n  _s();\n  let {\n    children\n  } = _ref;\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const [proset, setProvider] = useState(false);\n  const provider = new WalletConnectProvdier({\n    infuraId: \"ff2d998f9cdf4be29197ce3ffb727d89\",\n    qrcodeModalOptions: {\n      desktopLinks: ['ledger', 'tokenary', 'wallet', 'wallet 3', 'secuX', 'ambire', 'wallet3', 'apolloX', 'zerion', 'sequence', 'punkWallet', 'kryptoGO', 'nft', 'riceWallet', 'vision', 'keyring'],\n      mobileLinks: [\"rainbow\", \"metamask\", \"argent\", \"trust\", \"imtoken\", \"pillar\"]\n    }\n  });\n  const init = useCallback(async artifact => {\n    if (artifact) {\n      // const web3 = new Web3(Web3.givenProvider || \"ws://127.0.0.1:7545\");\n\n      console.log(provider);\n      const web3 = new Web3(provider);\n\n      // Subscribe to accounts change\n      provider.on(\"accountsChanged\", accounts => {\n        console.log(accounts);\n      });\n\n      // Subscribe to chainId change\n      provider.on(\"chainChanged\", chainId => {\n        console.log(chainId);\n      });\n\n      // Subscribe to session disconnection\n      provider.on(\"disconnect\", (code, reason) => {\n        console.log(code, reason);\n      });\n\n      // const web3 = new Web3(Web3.givenProvider || \"ws://goerli.infura.io/v3/ff2d998f9cdf4be29197ce3ffb727d89\");\n      const accounts = await web3.eth.getAccounts();\n      const networkID = await web3.eth.net.getId();\n      const {\n        abi\n      } = artifact;\n      let address, contract;\n      try {\n        address = artifact.networks[networkID].address;\n        contract = new web3.eth.Contract(abi, address);\n        for (let i = 0; i < 1; i++) {\n          //조건은 토큰아이디 or block size-1해서 제한해야함\n          //지금 다른계정이 업로드한 노래는 반영을 못하는 구조임.\n          try {\n            const value = await contract.methods.tokenURI(i).call();\n            const response = await fetch(value);\n            if (!response.ok) throw new Error(response.statusText);\n            const json = await response.json();\n            //이 json을 넘겨주면된다!\n            newjson.push(json);\n            //여기서 던져줘야할듯..ㅋㅋ\n          } catch (err) {}\n        }\n      } catch (err) {\n        console.error(err);\n        console.log(\"에러위치\");\n      }\n      dispatch({\n        type: actions.init,\n        data: {\n          artifact,\n          web3,\n          accounts,\n          networkID,\n          contract,\n          newjson,\n          provider\n        }\n      });\n    }\n  }, []);\n  useEffect(() => {\n    const tryInit = async () => {\n      try {\n        const artifact = require(\"../../contracts/ArtGrowNFT.json\");\n        init(artifact);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n    tryInit();\n  }, [init]);\n  useEffect(() => {\n    const events = [\"chainChanged\", \"accountsChanged\"];\n    const handleChange = () => {\n      init(state.artifact);\n    };\n    events.forEach(e => window.ethereum.on(e, handleChange));\n    return () => {\n      events.forEach(e => window.ethereum.removeListener(e, handleChange));\n    };\n  }, [init, state.artifact]);\n  async function Provide() {\n    console.log(provider);\n    await provider.enable();\n  }\n  return /*#__PURE__*/_jsxDEV(EthContext.Provider, {\n    value: {\n      state,\n      dispatch\n    },\n    children: [children, !proset && /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: Provide,\n        children: \"\\uC9C0\\uAC11\\uC5F0\\uACB0\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 167,\n    columnNumber: 5\n  }, this);\n}\n_s(EthProvider, \"zAynNKLG8PA4TBxKYif2YtVwKQ0=\");\n_c = EthProvider;\nexport default EthProvider;\nvar _c;\n$RefreshReg$(_c, \"EthProvider\");","map":{"version":3,"names":["React","useReducer","useCallback","useEffect","useState","Web3","EthContext","reducer","actions","initialState","WalletConnectProvdier","newjson","imgjson","EthProvider","children","state","dispatch","proset","setProvider","provider","infuraId","qrcodeModalOptions","desktopLinks","mobileLinks","init","artifact","console","log","web3","on","accounts","chainId","code","reason","eth","getAccounts","networkID","net","getId","abi","address","contract","networks","Contract","i","value","methods","tokenURI","call","response","fetch","ok","Error","statusText","json","push","err","error","type","data","tryInit","require","events","handleChange","forEach","e","window","ethereum","removeListener","Provide","enable"],"sources":["C:/Users/paete/Prototype/nftmusicProtoCopy/client/src/contexts/EthContext/EthProvider.jsx"],"sourcesContent":["import React, { useReducer, useCallback, useEffect, useState } from \"react\";\nimport Web3 from \"web3\";\nimport EthContext from \"./EthContext\";\nimport { reducer, actions, initialState } from \"./state\";\nimport WalletConnectProvdier from \"@walletconnect/web3-provider\";\n\nvar newjson=[]\nvar imgjson=[];\n  \n\nexport function EthProvider({ children }) {\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const [proset,setProvider]=useState(false);\n\n     \n const provider = new WalletConnectProvdier({\n  infuraId: \"ff2d998f9cdf4be29197ce3ffb727d89\",\n \n \n qrcodeModalOptions: {\n   desktopLinks: [\n     'ledger',\n     'tokenary',\n     'wallet',\n     'wallet 3',\n     'secuX',\n     'ambire',\n     'wallet3',\n     'apolloX',\n     'zerion',\n     'sequence',\n     'punkWallet',\n     'kryptoGO',\n     'nft',\n     'riceWallet',\n     'vision',\n     'keyring'\n   ],\n   mobileLinks: [\n     \"rainbow\",\n     \"metamask\",\n     \"argent\",\n     \"trust\",\n     \"imtoken\",\n     \"pillar\",\n   ],}});\n\n\n  const init = useCallback(\n    async artifact => {\n      if (artifact) {\n        // const web3 = new Web3(Web3.givenProvider || \"ws://127.0.0.1:7545\");\n\n              console.log(provider)\n              const web3 = new Web3(provider);\n              \n              // Subscribe to accounts change\nprovider.on(\"accountsChanged\", (accounts) => {\n  console.log(accounts);\n});\n\n// Subscribe to chainId change\nprovider.on(\"chainChanged\", (chainId) => {\n  console.log(chainId);\n});\n\n// Subscribe to session disconnection\nprovider.on(\"disconnect\", (code,reason) => {\n  console.log(code, reason);\n});\n           \n \n           \n        // const web3 = new Web3(Web3.givenProvider || \"ws://goerli.infura.io/v3/ff2d998f9cdf4be29197ce3ffb727d89\");\n        const accounts = await web3.eth.getAccounts();\n        const networkID = await web3.eth.net.getId();\n       \n        const { abi } = artifact;\n        let address, contract;\n\n\n        \n\n        try {\n          address = artifact.networks[networkID].address;\n          contract = new web3.eth.Contract(abi, address);\n\n\n          \n\n          for(let i=0; i<1; i++)\n    {\n      //조건은 토큰아이디 or block size-1해서 제한해야함\n      //지금 다른계정이 업로드한 노래는 반영을 못하는 구조임.\n     try{\n      const value = await contract.methods.tokenURI(i).call();\n      \n      const response = await fetch(value);\n      if(!response.ok)\n      throw new Error(response.statusText);\n      const json = await response.json();\n      //이 json을 넘겨주면된다!\n      newjson.push(json);\n      //여기서 던져줘야할듯..ㅋㅋ\n     }\n     catch (err) {\n      \n\n    }\n     \n    }\n    \n   \n          \n        } catch (err) {\n          console.error(err);\n          console.log(\"에러위치\");\n        }\n        dispatch({\n          type: actions.init,\n          data: { artifact, web3, accounts, networkID, contract,newjson,provider}\n        });\n      }\n    }, []);\n\n  \n \n    \n   \n  useEffect(() => {\n    const tryInit = async () => {\n      try {\n        const artifact = require(\"../../contracts/ArtGrowNFT.json\");\n        init(artifact);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    tryInit();\n  }, [init]);\n\n  \n\n  useEffect(() => {\n    const events = [\"chainChanged\", \"accountsChanged\"];\n    const handleChange = () => {\n      init(state.artifact);\n\n    };\n    events.forEach(e => window.ethereum.on(e, handleChange));\n    return () => {\n      events.forEach(e => window.ethereum.removeListener(e, handleChange));\n    };\n  }, [init,state.artifact]);\n\n  \n  \nasync function Provide()\n{\n\n  console.log(provider)\n  await provider.enable();\n}\n  return (\n    \n    <EthContext.Provider value={{\n      state,\n      dispatch\n    }}>\n      \n      {children}\n  {!proset&&<div>\n    <button onClick={Provide}>지갑연결</button>\n  </div>}\n      \n    </EthContext.Provider>\n    \n    \n  );\n}\n\n\nexport default EthProvider;\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}