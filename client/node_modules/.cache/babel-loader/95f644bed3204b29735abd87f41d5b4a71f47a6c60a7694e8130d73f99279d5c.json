{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/paete/Prototype/nftmusicProtoCopy/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/paete/Prototype/nftmusicProtoCopy/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/paete/Prototype/nftmusicProtoCopy/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useReducer,useCallback,useEffect,useState}from\"react\";import Web3 from\"web3\";import EthContext from\"./EthContext\";import{reducer,actions,initialState}from\"./state\";import WalletConnectProvdier from\"@walletconnect/web3-provider\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var newjson=[];var imgjson=[];export function EthProvider(_ref){var children=_ref.children;var _useReducer=useReducer(reducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),proset=_useState2[0],setProvider=_useState2[1];var provider=new WalletConnectProvdier({infuraId:\"ff2d998f9cdf4be29197ce3ffb727d89\",qrcodeModalOptions:{desktopLinks:['ledger','tokenary','wallet','wallet 3','secuX','ambire','wallet3','apolloX','zerion','sequence','punkWallet','kryptoGO','nft','riceWallet','vision','keyring'],mobileLinks:[\"rainbow\",\"metamask\",\"argent\",\"trust\",\"imtoken\",\"pillar\"]}});var init=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(artifact){var web3,accounts,networkID,abi,address,contract,i,value,response,json;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!artifact){_context.next=45;break;}// const web3 = new Web3(Web3.givenProvider || \"ws://127.0.0.1:7545\");\nconsole.log(provider);web3=new Web3(provider);// Subscribe to accounts change\nprovider.on(\"accountsChanged\",function(accounts){console.log(accounts);});// Subscribe to chainId change\nprovider.on(\"chainChanged\",function(chainId){console.log(chainId);});// Subscribe to session disconnection\nprovider.on(\"disconnect\",function(code,reason){console.log(code,reason);});// const web3 = new Web3(Web3.givenProvider || \"ws://goerli.infura.io/v3/ff2d998f9cdf4be29197ce3ffb727d89\");\n_context.next=8;return web3.eth.getAccounts();case 8:accounts=_context.sent;_context.next=11;return web3.eth.net.getId();case 11:networkID=_context.sent;abi=artifact.abi;_context.prev=13;address=artifact.networks[networkID].address;contract=new web3.eth.Contract(abi,address);i=0;case 17:if(!(i<1)){_context.next=38;break;}_context.prev=18;_context.next=21;return contract.methods.tokenURI(i).call();case 21:value=_context.sent;_context.next=24;return fetch(value);case 24:response=_context.sent;if(response.ok){_context.next=27;break;}throw new Error(response.statusText);case 27:_context.next=29;return response.json();case 29:json=_context.sent;//이 json을 넘겨주면된다!\nnewjson.push(json);//여기서 던져줘야할듯..ㅋㅋ\n_context.next=35;break;case 33:_context.prev=33;_context.t0=_context[\"catch\"](18);case 35:i++;_context.next=17;break;case 38:_context.next=44;break;case 40:_context.prev=40;_context.t1=_context[\"catch\"](13);console.error(_context.t1);console.log(\"에러위치\");case 44:dispatch({type:actions.init,data:{artifact:artifact,web3:web3,accounts:accounts,networkID:networkID,contract:contract,newjson:newjson,provider:provider}});case 45:case\"end\":return _context.stop();}},_callee,null,[[13,40],[18,33]]);}));return function(_x){return _ref2.apply(this,arguments);};}(),[]);useEffect(function(){var tryInit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var artifact;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:try{artifact=require(\"../../contracts/ArtGrowNFT.json\");init(artifact);}catch(err){console.error(err);}case 1:case\"end\":return _context2.stop();}},_callee2);}));return function tryInit(){return _ref3.apply(this,arguments);};}();tryInit();},[init]);useEffect(function(){var events=[\"chainChanged\",\"accountsChanged\"];var handleChange=function handleChange(){init(state.artifact);};events.forEach(function(e){return window.ethereum.on(e,handleChange);});return function(){events.forEach(function(e){return window.ethereum.removeListener(e,handleChange);});};},[init,state.artifact]);function Provide(){return _Provide.apply(this,arguments);}function _Provide(){_Provide=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:console.log(provider);_context3.next=3;return provider.enable();case 3:case\"end\":return _context3.stop();}},_callee3);}));return _Provide.apply(this,arguments);}return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(EthContext.Provider,{value:{state:state,dispatch:dispatch},children:children}),!proset&&/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gridRow:'5/6',gridColumn:'1/3'},children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){Provide();setProvider(true);},children:\"\\uC9C0\\uAC11\\uC5F0\\uACB0\"})})]});}export default EthProvider;","map":{"version":3,"names":["React","useReducer","useCallback","useEffect","useState","Web3","EthContext","reducer","actions","initialState","WalletConnectProvdier","newjson","imgjson","EthProvider","children","state","dispatch","proset","setProvider","provider","infuraId","qrcodeModalOptions","desktopLinks","mobileLinks","init","artifact","console","log","web3","on","accounts","chainId","code","reason","eth","getAccounts","net","getId","networkID","abi","address","networks","contract","Contract","i","methods","tokenURI","call","value","fetch","response","ok","Error","statusText","json","push","error","type","data","tryInit","require","err","events","handleChange","forEach","e","window","ethereum","removeListener","Provide","enable","display","gridRow","gridColumn"],"sources":["C:/Users/paete/Prototype/nftmusicProtoCopy/client/src/contexts/EthContext/EthProvider.jsx"],"sourcesContent":["import React, { useReducer, useCallback, useEffect, useState } from \"react\";\nimport Web3 from \"web3\";\nimport EthContext from \"./EthContext\";\nimport { reducer, actions, initialState } from \"./state\";\nimport WalletConnectProvdier from \"@walletconnect/web3-provider\";\n\nvar newjson=[]\nvar imgjson=[];\n  \n\nexport function EthProvider({ children }) {\n  const [state, dispatch] = useReducer(reducer, initialState);\n  const [proset,setProvider]=useState(false);\n\n     \n const provider = new WalletConnectProvdier({\n  infuraId: \"ff2d998f9cdf4be29197ce3ffb727d89\",\n \n \n qrcodeModalOptions: {\n   desktopLinks: [\n     'ledger',\n     'tokenary',\n     'wallet',\n     'wallet 3',\n     'secuX',\n     'ambire',\n     'wallet3',\n     'apolloX',\n     'zerion',\n     'sequence',\n     'punkWallet',\n     'kryptoGO',\n     'nft',\n     'riceWallet',\n     'vision',\n     'keyring'\n   ],\n   mobileLinks: [\n     \"rainbow\",\n     \"metamask\",\n     \"argent\",\n     \"trust\",\n     \"imtoken\",\n     \"pillar\",\n   ],}});\n\n\n  const init = useCallback(\n    async artifact => {\n      if (artifact) {\n        // const web3 = new Web3(Web3.givenProvider || \"ws://127.0.0.1:7545\");\n\n              console.log(provider)\n              const web3 = new Web3(provider);\n              \n              // Subscribe to accounts change\nprovider.on(\"accountsChanged\", (accounts) => {\n  console.log(accounts);\n});\n\n// Subscribe to chainId change\nprovider.on(\"chainChanged\", (chainId) => {\n  console.log(chainId);\n});\n\n// Subscribe to session disconnection\nprovider.on(\"disconnect\", (code,reason) => {\n  console.log(code, reason);\n});\n           \n \n           \n        // const web3 = new Web3(Web3.givenProvider || \"ws://goerli.infura.io/v3/ff2d998f9cdf4be29197ce3ffb727d89\");\n        const accounts = await web3.eth.getAccounts();\n        const networkID = await web3.eth.net.getId();\n       \n        const { abi } = artifact;\n        let address, contract;\n\n\n        \n\n        try {\n          address = artifact.networks[networkID].address;\n          contract = new web3.eth.Contract(abi, address);\n\n\n          \n\n          for(let i=0; i<1; i++)\n    {\n      //조건은 토큰아이디 or block size-1해서 제한해야함\n      //지금 다른계정이 업로드한 노래는 반영을 못하는 구조임.\n     try{\n      const value = await contract.methods.tokenURI(i).call();\n      \n      const response = await fetch(value);\n      if(!response.ok)\n      throw new Error(response.statusText);\n      const json = await response.json();\n      //이 json을 넘겨주면된다!\n      newjson.push(json);\n      //여기서 던져줘야할듯..ㅋㅋ\n     }\n     catch (err) {\n      \n\n    }\n     \n    }\n    \n   \n          \n        } catch (err) {\n          console.error(err);\n          console.log(\"에러위치\");\n        }\n        dispatch({\n          type: actions.init,\n          data: { artifact, web3, accounts, networkID, contract,newjson,provider}\n        });\n      }\n    }, []);\n\n  \n \n    \n   \n  useEffect(() => {\n    const tryInit = async () => {\n      try {\n        const artifact = require(\"../../contracts/ArtGrowNFT.json\");\n        init(artifact);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    tryInit();\n  }, [init]);\n\n  \n\n  useEffect(() => {\n    const events = [\"chainChanged\", \"accountsChanged\"];\n    const handleChange = () => {\n      init(state.artifact);\n\n    };\n    events.forEach(e => window.ethereum.on(e, handleChange));\n    return () => {\n      events.forEach(e => window.ethereum.removeListener(e, handleChange));\n    };\n  }, [init,state.artifact]);\n\n  \n  \nasync function Provide()\n{\n\n  console.log(provider)\n  await provider.enable();\n}\n  return (\n    \n  <React.Fragment>\n      <EthContext.Provider value={{\n      state,\n      dispatch\n    }}>\n      \n      {children}\n  \n    </EthContext.Provider>\n    {!proset&&<div style={{display:'flex',gridRow:'5/6',gridColumn:'1/3'}}>\n    <button onClick={() => {Provide();  setProvider(true) } }>지갑연결</button>\n  </div>}\n      \n  \n  </React.Fragment>  \n    \n  );\n}\n\n\nexport default EthProvider;\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}