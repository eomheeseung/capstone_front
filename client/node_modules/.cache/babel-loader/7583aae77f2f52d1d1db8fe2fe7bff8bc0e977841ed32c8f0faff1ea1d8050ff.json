{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/paete/Prototype/nftmusicProtoCopy/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/paete/Prototype/nftmusicProtoCopy/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/paete/Prototype/nftmusicProtoCopy/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useReducer,useCallback,useEffect}from\"react\";import Web3 from\"web3\";import EthContext from\"./EthContext\";import{reducer,actions,initialState}from\"./state\";import{jsx as _jsx}from\"react/jsx-runtime\";var newjson=[];var imgjson=[];export function EthProvider(_ref){var children=_ref.children;var _useReducer=useReducer(reducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var init=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(artifact){var web3,accounts,networkID,abi,address,contract,i,value,_response,json,Writer,response,json1,imgjson2,imgsrc1,imgsrc2,imgsrc3,author,name;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!artifact){_context.next=57;break;}// const web3 = new Web3(Web3.givenProvider || \"ws://127.0.0.1:7545\");\nweb3=new Web3(Web3.givenProvider||\"ws://goerli.infura.io/v3/ff2d998f9cdf4be29197ce3ffb727d89\");_context.next=4;return web3.eth.requestAccounts();case 4:accounts=_context.sent;_context.next=7;return web3.eth.net.getId();case 7:networkID=_context.sent;abi=artifact.abi;_context.prev=9;address=artifact.networks[networkID].address;contract=new web3.eth.Contract(abi,address);i=0;case 13:if(!(i<1)){_context.next=35;break;}_context.prev=14;_context.next=17;return contract.methods.tokenURI(i).call();case 17:value=_context.sent;_context.next=20;return fetch(value);case 20:_response=_context.sent;if(_response.ok){_context.next=23;break;}throw new Error(_response.statusText);case 23:_context.next=25;return _response.json();case 25:json=_context.sent;//이 json을 넘겨주면된다!\nnewjson.push(json);//여기서 던져줘야할듯..ㅋㅋ\n_context.next=32;break;case 29:_context.prev=29;_context.t0=_context[\"catch\"](14);return _context.abrupt(\"break\",35);case 32:i++;_context.next=13;break;case 35:_context.next=37;return contract.methods.tokenURI(3).call();case 37:Writer=_context.sent;_context.next=40;return fetch(Writer);case 40:response=_context.sent;if(response.ok){_context.next=43;break;}throw new Error(response.statusText);case 43:_context.next=45;return response.json();case 45:json1=_context.sent;console.log(json1);imgjson.push(json1);imgjson2=[];if(imgjson[0]!=='undefined'&&imgjson[0]!=null){imgsrc1=imgjson[0].links.images[0].url;imgsrc2=imgjson[0].links.images[1].url;imgsrc3=imgjson[0].links.images[2].url;author=imgjson[0].author;name=imgjson[0].name;imgjson2.push(imgsrc1);imgjson2.push(imgsrc2);imgjson2.push(imgsrc3);imgjson2.push(author);imgjson2.push(name);}_context.next=56;break;case 52:_context.prev=52;_context.t1=_context[\"catch\"](9);console.error(_context.t1);console.log(\"에러위치\");case 56:dispatch({type:actions.init,data:{artifact:artifact,web3:web3,accounts:accounts,networkID:networkID,contract:contract,newjson:newjson,imgjson2:imgjson2}});case 57:case\"end\":return _context.stop();}},_callee,null,[[9,52],[14,29]]);}));return function(_x){return _ref2.apply(this,arguments);};}(),[]);useEffect(function(){var tryInit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var artifact;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:try{artifact=require(\"../../contracts/ArtGrowNFT.json\");init(artifact);}catch(err){console.error(err);}case 1:case\"end\":return _context2.stop();}},_callee2);}));return function tryInit(){return _ref3.apply(this,arguments);};}();tryInit();},[init]);useEffect(function(){var events=[\"chainChanged\",\"accountsChanged\"];var handleChange=function handleChange(){init(state.artifact);};events.forEach(function(e){return window.ethereum.on(e,handleChange);});return function(){events.forEach(function(e){return window.ethereum.removeListener(e,handleChange);});};},[init,state.artifact]);return/*#__PURE__*/_jsx(EthContext.Provider,{value:{state:state,dispatch:dispatch},children:children});}export default EthProvider;","map":{"version":3,"names":["React","useReducer","useCallback","useEffect","Web3","EthContext","reducer","actions","initialState","newjson","imgjson","EthProvider","children","state","dispatch","init","artifact","web3","givenProvider","eth","requestAccounts","accounts","net","getId","networkID","abi","address","networks","contract","Contract","i","methods","tokenURI","call","value","fetch","response","ok","Error","statusText","json","push","Writer","json1","console","log","imgjson2","imgsrc1","links","images","url","imgsrc2","imgsrc3","author","name","error","type","data","tryInit","require","err","events","handleChange","forEach","e","window","ethereum","on","removeListener"],"sources":["C:/Users/paete/Prototype/nftmusicProtoCopy/client/src/contexts/EthContext/EthProvider.jsx"],"sourcesContent":["import React, { useReducer, useCallback, useEffect } from \"react\";\nimport Web3 from \"web3\";\nimport EthContext from \"./EthContext\";\nimport { reducer, actions, initialState } from \"./state\";\n\n\n\nvar newjson=[]\nvar imgjson=[];\n          \n\nexport function EthProvider({ children }) {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const init = useCallback(\n\n    async artifact => {\n      if (artifact) {\n        // const web3 = new Web3(Web3.givenProvider || \"ws://127.0.0.1:7545\");\n\n        const web3 = new Web3(Web3.givenProvider || \"ws://goerli.infura.io/v3/ff2d998f9cdf4be29197ce3ffb727d89\");\n        const accounts = await web3.eth.requestAccounts();\n        const networkID = await web3.eth.net.getId();\n        const { abi } = artifact;\n        let address, contract;\n\n        try {\n          address = artifact.networks[networkID].address;\n          contract = new web3.eth.Contract(abi, address);\n\n          for(let i=0; i<1; i++)\n    {\n      //조건은 토큰아이디 or block size-1해서 제한해야함\n      //지금 다른계정이 업로드한 노래는 반영을 못하는 구조임.\n     try{\n      const value = await contract.methods.tokenURI(i).call();\n      \n      const response = await fetch(value);\n      if(!response.ok)\n      throw new Error(response.statusText);\n      const json = await response.json();\n      //이 json을 넘겨주면된다!\n      newjson.push(json);\n      //여기서 던져줘야할듯..ㅋㅋ\n     }\n     catch (err) {\n      break;\n\n    }\n     \n    }\n    // const valued=await contract.methods.balanceOf(accounts[0]).call();\n    const Writer= await contract.methods.tokenURI(3).call();\n    const response = await fetch(Writer);\n      if(!response.ok)\n      throw new Error(response.statusText);\n      const json1 = await response.json();\n      console.log(json1)\n      imgjson.push(json1);\n      var imgjson2=[]\n\n      if(imgjson[0] !== 'undefined' && imgjson[0] != null)\n      {\n        var imgsrc1=imgjson[0].links.images[0].url;\n        var imgsrc2=imgjson[0].links.images[1].url;\n        var imgsrc3=imgjson[0].links.images[2].url;\n        var author=imgjson[0].author;\n        var name=imgjson[0].name;\n        \n        imgjson2.push(imgsrc1)\n        imgjson2.push(imgsrc2)\n        imgjson2.push(imgsrc3)\n        \n        imgjson2.push(author)\n        imgjson2.push(name)\n        \n      }\n\n      \n\n          \n        } catch (err) {\n          console.error(err);\n          console.log(\"에러위치\");\n        }\n        dispatch({\n          type: actions.init,\n          data: { artifact, web3, accounts, networkID, contract,newjson,imgjson2}\n        });\n      }\n    }, []);\n\n  \n   \n    \n   \n  useEffect(() => {\n    const tryInit = async () => {\n      try {\n        const artifact = require(\"../../contracts/ArtGrowNFT.json\");\n        init(artifact);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    tryInit();\n  }, [init]);\n\n  \n\n  useEffect(() => {\n    const events = [\"chainChanged\", \"accountsChanged\"];\n    const handleChange = () => {\n      init(state.artifact);\n\n    };\n    events.forEach(e => window.ethereum.on(e, handleChange));\n    return () => {\n      events.forEach(e => window.ethereum.removeListener(e, handleChange));\n    };\n  }, [init,state.artifact]);\n\n  return (\n    <EthContext.Provider value={{\n      state,\n      dispatch\n    }}>\n      {children}\n    </EthContext.Provider>\n    \n  );\n}\n\n\nexport default EthProvider;\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}